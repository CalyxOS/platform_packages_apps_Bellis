{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "b7b0ee3e_e9278151",
        "filename": "app/src/main/java/org/calyxos/bellis/PostProvisioningHelper.kt",
        "patchSetId": 9
      },
      "lineNbr": 45,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-07-17T17:01:48Z",
      "side": 1,
      "message": "Is it OK to do the entirety of the post-provisioning tasks in a worker, not just enabling system apps? I have a local variant of this change that does so, and waits to setProfileEnabled until everything else is done (in a finally block though so it\u0027s not missed); then, at the end, it sets PREF_DONE. It works for me, but I\u0027m asking if it\u0027s advisable code-wise or if there are possible objections to this.\n\nThis allows us to know for sure that provisioningComplete actually means everything is done, including enabling system apps. If we are going to have a Please Wait screen anyway, we might as well do this, imo.",
      "revId": "1e5d35b1a30b224d19fad53ea679ec9e1dc12636",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "be30b5bf_4c29e03f",
        "filename": "app/src/main/java/org/calyxos/bellis/PostProvisioningHelper.kt",
        "patchSetId": 9
      },
      "lineNbr": 45,
      "author": {
        "id": 1000065
      },
      "writtenOn": "2023-07-17T17:45:45Z",
      "side": 1,
      "message": "I will advise against so. The reason is that this worker will be dropped from running if it can\u0027t run as expedited, which is decided using quotas and doze on new Android versions. It is fine if apps don\u0027t get enabled as users can do that manually. However, we need to do clearing restrictions and other tasks for them.",
      "parentUuid": "b7b0ee3e_e9278151",
      "revId": "1e5d35b1a30b224d19fad53ea679ec9e1dc12636",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c65d47ed_d0d0072d",
        "filename": "app/src/main/java/org/calyxos/bellis/PostProvisioningHelper.kt",
        "patchSetId": 9
      },
      "lineNbr": 45,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-07-17T20:34:43Z",
      "side": 1,
      "message": "Okay, understood... That doesn\u0027t seem ideal either, though. Even if enabling the system apps isn\u0027t essential compared to other things, surely there\u0027s some way we can make sure the code actually gets attempted instead of being possibly dropped. Any ideas?\n\nOtherwise I guess we could just use coroutines or something for the other stuff so we don\u0027t block the UI.",
      "parentUuid": "be30b5bf_4c29e03f",
      "revId": "1e5d35b1a30b224d19fad53ea679ec9e1dc12636",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "83e68eac_6e20983a",
        "filename": "app/src/main/java/org/calyxos/bellis/PostProvisioningHelper.kt",
        "patchSetId": 9
      },
      "lineNbr": 45,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-07-17T20:36:36Z",
      "side": 1,
      "message": "Also, we use this policy right now: OutOfQuotaPolicy.RUN_AS_NON_EXPEDITED_WORK_REQUEST\n\nSo would what you said still apply?",
      "parentUuid": "c65d47ed_d0d0072d",
      "revId": "1e5d35b1a30b224d19fad53ea679ec9e1dc12636",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8d1adee3_e762d8db",
        "filename": "app/src/main/java/org/calyxos/bellis/PostProvisioningHelper.kt",
        "patchSetId": 9
      },
      "lineNbr": 45,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-07-18T16:50:01Z",
      "side": 1,
      "message": "https://developer.android.com/reference/androidx/work/OutOfQuotaPolicy",
      "parentUuid": "83e68eac_6e20983a",
      "revId": "1e5d35b1a30b224d19fad53ea679ec9e1dc12636",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6f8ee49d_b693ccd7",
        "filename": "app/src/main/java/org/calyxos/bellis/PostProvisioningHelper.kt",
        "patchSetId": 9
      },
      "lineNbr": 45,
      "author": {
        "id": 1000065
      },
      "writtenOn": "2023-07-18T18:14:36Z",
      "side": 1,
      "message": "It wouldn\u0027t be dropped but will be run as non-expedited when possible. The link Chirayu shared highlights about in detail.",
      "parentUuid": "8d1adee3_e762d8db",
      "revId": "1e5d35b1a30b224d19fad53ea679ec9e1dc12636",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    }
  ]
}