{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ef670501_27103402",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000065
      },
      "writtenOn": "2023-06-09T15:19:55Z",
      "side": 1,
      "message": "I think this is fine for now as there is literally nothing that should be backed up. Maybe when we release it publicly on third party appstores, we can revisit this.",
      "revId": "9afb9418213d487c636aaea9d333244c74a37e39",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8b9a4749_15f53c03",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-09T16:05:53Z",
      "side": 1,
      "message": "I\u0027d rather not. This is a bad precedent.",
      "parentUuid": "ef670501_27103402",
      "revId": "9afb9418213d487c636aaea9d333244c74a37e39",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "27e4212b_e5d6ac27",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-13T19:26:16Z",
      "side": 1,
      "message": "Maybe the following is one reason why, as it stands, this change may be a good idea: https://review.calyxos.org/c/CalyxOS/platform_packages_apps_Bellis/+/16124/comments/586f0487_86a643f2\n\nBut I think the above-linked problem should be fixed.",
      "revId": "9afb9418213d487c636aaea9d333244c74a37e39",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fe26dffa_5ae2eeb7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-13T19:38:27Z",
      "side": 1,
      "message": "It\u0027d only be a bandaid fix.\n\n(fake-)d2d would ignore this.\n\nThe correct way would be to\n1) Not backup this pref\n2) Why is it only relying on the pref? It should also rely on the system setting which should also get restored. If pref doesn\u0027t match system setting, update it to match that.",
      "parentUuid": "27e4212b_e5d6ac27",
      "revId": "9afb9418213d487c636aaea9d333244c74a37e39",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d076fe36_84f53e56",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-13T19:45:45Z",
      "side": 1,
      "message": "Agree; the reason for the pref is that it was an easy way to be sure that the particular profile is the Safer/Safest profile, instead of a profile added later (multiple profiles), without assuming Safer/Safest is the first profile found or something, which might not be guaranteed to be true forever. But it looks like we may want/need something more robust than that.",
      "parentUuid": "fe26dffa_5ae2eeb7",
      "revId": "9afb9418213d487c636aaea9d333244c74a37e39",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3155d025_09c87df5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-13T19:50:29Z",
      "side": 1,
      "message": "One second though, why would (fake-)d2d ignore this change? The device-transfer rules should prevent it, I thought.",
      "parentUuid": "d076fe36_84f53e56",
      "revId": "9afb9418213d487c636aaea9d333244c74a37e39",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "edb53a79_7ab6e5b4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-14T22:18:36Z",
      "side": 1,
      "message": "I\u0027ve learned a few important things about this.\n\n1. When backup is allowed for Bellis, the system will crash if we try to restore data in a Safer or Safest work profile. See https://gitlab.com/CalyxOS/calyxos/-/issues/1721\n2. The forced backup/restore of D2D migrations [does not affect system apps](https://cs.android.com/android/platform/superproject/+/android-13.0.0_r52:frameworks/base/services/backup/java/com/android/server/backup/utils/BackupEligibilityRules.java;l\u003d159-168;bpv\u003d0;bpt\u003d0); they won\u0027t be backed up if `allowBackup\u003d\"false\"`. However, we\u0027ve been trying to develop Bellis in a portable manner, so depending on it being a system app is worth avoiding where possible, if we want to stick to that standard.\n3. With this patch as-is (`allowBackup\u003d\"false\"`, `\u003cdevice-transfer\u003e` extraction rules that exclude all domains), when Bellis is not a system app, a MIGRATION restore will still commence with the restore process, starting with clearing the app data. This clear-data step causes the crash mentioned in 1. (I haven\u0027t yet tested if it ends up successfully restoring data; I\u0027d have to try in Standard so it doesn\u0027t crash.)\n\nIt should be possible to implement a simple BackupAgent that allows us to select what, if anything, we back up and restore. This would also prevent the crash.",
      "revId": "9afb9418213d487c636aaea9d333244c74a37e39",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9068491a_620cbfa4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-14T22:45:09Z",
      "side": 1,
      "message": "Note that if a full backup of the app was taken, a migration will still try to restore the full backup as usual even if we\u0027ve switched to using a BackupAgent... so, still causes the crash. Not sure if this would also be the case without any D2D shenanigans; would have to test, but I\u0027m guessing probably yes.",
      "parentUuid": "edb53a79_7ab6e5b4",
      "revId": "9afb9418213d487c636aaea9d333244c74a37e39",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "53e57743_b68e4aa6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-08-23T18:32:13Z",
      "side": 1,
      "message": "Ack, the crash and related is tracked here: https://gitlab.com/CalyxOS/calyxos/-/issues/1721",
      "parentUuid": "9068491a_620cbfa4",
      "revId": "9afb9418213d487c636aaea9d333244c74a37e39",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    }
  ]
}