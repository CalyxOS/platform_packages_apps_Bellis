{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "41b20779_fe2dbd57",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-16T09:41:19Z",
      "side": 1,
      "message": "Note: This commit is simply rewriting the existing migration code. There\u0027s no behaviour change, only bug fixes.\n\nAny change if needed should happen separately, in a follow up commit, to avoid confusion.\n\nAlso, given that this is doing migration properly now (with versioning), they shouldn\u0027t be removed unless for rare exceptions.",
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8d3a451e_6e8aa4f2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-16T14:54:37Z",
      "side": 1,
      "message": "While clearly this had bugs due to `when`, we haven\u0027t had that many complaints.\n\nLet\u0027s hold off for a bit and have everyone get on the same page before shipping.",
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5d9935f5_71ae46bb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-16T14:58:40Z",
      "side": 1,
      "message": "Also, I also wanted this to serve as a reference for how we should be doing migrations, given that we copied it from the latest code and by now have had quite a few sets of eyes go through it, and plenty of discussion as well.",
      "parentUuid": "8d3a451e_6e8aa4f2",
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7319e463_228b8106",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-16T20:25:34Z",
      "side": 1,
      "message": "I would love to see this merged soon, if we can come to an agreement, because it\u0027s hard to maintain any nearby code while it\u0027s still broken.",
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9810acff_a9003fa0",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 29,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-16T09:41:19Z",
      "side": 1,
      "message": "To switch to pure migration, we get rid of this.",
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "184f7438_25bf2134",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 29,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-16T14:22:24Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "9810acff_a9003fa0",
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f1cf2705_e46927e2",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 86,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-16T09:41:19Z",
      "side": 1,
      "message": "To switch to pure migration, we change this to PREF_VERSION instead.",
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "98bdd434_f8fc732b",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 86,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-16T14:22:24Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "f1cf2705_e46927e2",
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "76892a8f_50b86675",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 106,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-16T01:54:05Z",
      "side": 1,
      "message": "This exists in PostProvisioningHelper. Not sure where we should keep it but let\u0027s remove a duplicate. If we keep it here we may be able to remove PostProvisioningHelper entirely and move everything here. Keep in mind that we add a fair bit to PostProvisioningHelper in garlic level though. So could keep this purely for migrations in which case we should consider keeping defaults in PostProvisioningHelper?",
      "range": {
        "startLine": 105,
        "startChar": 20,
        "endLine": 106,
        "endChar": 83
      },
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1b610b00_d8c448f3",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 106,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-16T09:41:19Z",
      "side": 1,
      "message": "I asked this question in the channel, is it a pure migration (like Lineage Settings / old AOSP Settings), or migration + defaults (current AOSP settings).\n\nRight now, this patch is migration + defaults.\n\nWe need to pick one and stick with it. I\u0027m fine with this \"migration + defaults\" approach, but also ok with just migration. It\u0027s a one line change, anyways.",
      "parentUuid": "76892a8f_50b86675",
      "range": {
        "startLine": 105,
        "startChar": 20,
        "endLine": 106,
        "endChar": 83
      },
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f8947b1e_4fda5e5a",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 106,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-16T14:22:24Z",
      "side": 1,
      "message": "I\u0027m fine with migration + defaults, but let\u0027s get rid of PostProvisioningHelper (and move everything from there to this) then since all it\u0027s doing is setting up defaults",
      "parentUuid": "1b610b00_d8c448f3",
      "range": {
        "startLine": 105,
        "startChar": 20,
        "endLine": 106,
        "endChar": 83
      },
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cc146620_049286c4",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 106,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-16T14:28:50Z",
      "side": 1,
      "message": "+1 to doing initial setup in this service, and if that means doing it as part of establishment of defaults, that seems fine to me.\n\nThe main thing I have been wondering is if we should be doing all of this on another thread. Apparently in general, a [Service uses the same main thread as the frontend of an app itself](https://developer.android.com/guide/components/services), and the linked page features a big warning about it. I couldn\u0027t find info about whether DeviceAdminService works differently.",
      "parentUuid": "f8947b1e_4fda5e5a",
      "range": {
        "startLine": 105,
        "startChar": 20,
        "endLine": 106,
        "endChar": 83
      },
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9ac496e3_cd49fd1a",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 106,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-16T14:29:53Z",
      "side": 1,
      "message": "Should have said main thread. Anyway, shouldn\u0027t be hard to use a separate thread",
      "parentUuid": "cc146620_049286c4",
      "range": {
        "startLine": 105,
        "startChar": 20,
        "endLine": 106,
        "endChar": 83
      },
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3f1312d0_c7d9729d",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 115,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-16T01:54:05Z",
      "side": 1,
      "message": "See above, no duplicate but should it stay here or move there?",
      "range": {
        "startLine": 114,
        "startChar": 20,
        "endLine": 115,
        "endChar": 85
      },
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cf50c5a5_71a8c4f6",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 123,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-16T01:54:05Z",
      "side": 1,
      "message": "Is this still necessary at this point? If not I\u0027d like to remove this and revert the corresponding frameworks patch",
      "range": {
        "startLine": 123,
        "startChar": 20,
        "endLine": 123,
        "endChar": 79
      },
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "34ace839_4c3509e4",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 123,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-16T09:41:19Z",
      "side": 1,
      "message": "No, we shouldn\u0027t be removing anything needed for migration. It doesn\u0027t hurt at all having it here, and this when shipped should fix any devices where it\u0027s still an issue.\n\nFor example, fixed migration would help anyone who still has something like  https://www.reddit.com/r/CalyxOS/comments/126vr63/comment/jednd49/?utm_source\u003dshare\u0026utm_medium\u003dweb2x\u0026context\u003d3",
      "parentUuid": "cf50c5a5_71a8c4f6",
      "range": {
        "startLine": 123,
        "startChar": 20,
        "endLine": 123,
        "endChar": 79
      },
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5f4529e8_7b896aac",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 123,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-16T14:22:24Z",
      "side": 1,
      "message": "That user must have had a problem with the when blocks would be my guess.\n\nWe shouldn\u0027t keep this anymore. It required a frameworks change to work which makes it impossible to ship this as a user app as long as this exists. It is not needed anymore since we\u0027ve gone back to AOSP behaviour where frameworks sets this and all users would now have run this migration. It\u0027s also not proper to execute this again if it has already been set elsewhere (callbacks may trigger and cause unwanted execution of other calls).",
      "parentUuid": "34ace839_4c3509e4",
      "range": {
        "startLine": 123,
        "startChar": 20,
        "endLine": 123,
        "endChar": 79
      },
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bbc6531f_b32b185f",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 123,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-16T14:45:18Z",
      "side": 1,
      "message": "\u003e all users would now have run this migration.\n\nThey may not have, due to the `when`. That was the exact problem the user faced in the linked post, they had to fix it manually. Who knows if there\u0027s others.\n\nWe can drop it in 14, or when we go to \"stable6\" - basically after we ensure this has ran for everyone.",
      "parentUuid": "5f4529e8_7b896aac",
      "range": {
        "startLine": 123,
        "startChar": 20,
        "endLine": 123,
        "endChar": 79
      },
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "27e90d7f_b063d1fd",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 123,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-16T20:25:34Z",
      "side": 1,
      "message": "I agree that we should just keep it in for now, and then later remove it and replace it with a comment that the migration is no longer needed or something.\n\nBut for now let\u0027s surround it with a `try` block so we can catch the exception that would occur without access to user_setup_complete, and then this will still be portable (not crash without framework change) until we do remove it.",
      "parentUuid": "bbc6531f_b32b185f",
      "range": {
        "startLine": 123,
        "startChar": 20,
        "endLine": 123,
        "endChar": 79
      },
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0fb45ef6_a08b96cb",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 123,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-20T16:34:43Z",
      "side": 1,
      "message": "Good idea!",
      "parentUuid": "27e90d7f_b063d1fd",
      "range": {
        "startLine": 123,
        "startChar": 20,
        "endLine": 123,
        "endChar": 79
      },
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9401a5d2_1c1d2295",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 137,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-16T20:25:34Z",
      "side": 1,
      "message": "nit: replace \"Bellis\" with a `private val TAG`",
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7de017f0_da5fdfec",
        "filename": "app/src/main/java/org/calyxos/bellis/BasicDeviceAdminService.kt",
        "patchSetId": 10
      },
      "lineNbr": 137,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-20T19:07:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9401a5d2_1c1d2295",
      "revId": "26908c98d51000ea81c988f87c6de172360c6fbe",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    }
  ]
}