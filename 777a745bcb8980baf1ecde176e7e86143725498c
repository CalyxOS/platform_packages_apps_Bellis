{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "b52ad73a_d1bae846",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1000003
      },
      "writtenOn": "2023-06-07T13:54:07Z",
      "side": 1,
      "message": "Do we know why onCreate() is called again in the first place? Was the activity killed during SUW? Was it recreated because on configuration changes?",
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fc34da7e_238722da",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-07T14:00:40Z",
      "side": 1,
      "message": "Afaik it\u0027s not killed. The PID/TID are the same in the second call. Should that be definitive or is there a better way to know?\n\nFrom some of the things I was reading, it can be normal for it to be called a second time. I don\u0027t know if that\u0027s true.",
      "parentUuid": "b52ad73a_d1bae846",
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5389273_4c0c86b0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-07T14:02:02Z",
      "side": 1,
      "message": "Another thing I read is that this can happen if the called activity (SetupWizard in this case) doesn\u0027t finish() properly.",
      "parentUuid": "fc34da7e_238722da",
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "297e7a68_a9ebc66c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-07T14:20:28Z",
      "side": 1,
      "message": "It probably doesn\u0027t finish properly given it disables a bunch of components (and that\u0027s how it \"finishes\"). Interesting if that\u0027s the cause of this behaviour. Also would be more reason to refactor SUW in 14",
      "parentUuid": "b5389273_4c0c86b0",
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "11d2a9dc_c070bf06",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-06-07T14:22:10Z",
      "side": 1,
      "message": "Oh yes, I don\u0027t see it with 17585: Disable SetupWizard app entirely when done | https://review.calyxos.org/c/CalyxOS/platform_packages_apps_SetupWizard/+/17585\n\n(It works fine now)",
      "parentUuid": "297e7a68_a9ebc66c",
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3bfddd35_d518774e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-07T14:34:21Z",
      "side": 1,
      "message": "Another weird thing: sometimes Bellis has its onCreate called again while SetupWizard is still running, so you may be in the middle of it and see SetupWizard pop up again and interrupt you (prior to a fix). The intent is the same when this happens. I don\u0027t know why this happens -- maybe a bug in SetupWizard?\n\nStill, regardless of any bug in SetupWizard, we do need to be sure it\u0027s not launched multiple times.",
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ca03fd73_c01286ca",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-16T01:55:31Z",
      "side": 1,
      "message": "I feel like the real solution is https://review.calyxos.org/c/CalyxOS/platform_packages_apps_SetupWizard/+/17585 if we can get that to work?",
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b0005414_d0dad757",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-06T18:11:42Z",
      "side": 1,
      "message": "This doesn\u0027t seem quite right. Why is onCreate being called twice? I\u0027d rather handle this wherever this is being caused. The 2 calls below shouldn\u0027t be called more than once indeed",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9c7ca0e5_7c829719",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-06T18:26:41Z",
      "side": 1,
      "message": "Commit message clarifies why it is called again. Would still like to see if it can be handled differently",
      "parentUuid": "b0005414_d0dad757",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a9b6e8fb_8bbbafdb",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-06T18:28:43Z",
      "side": 1,
      "message": "I suppose the question is why is `ACTION_PROVISIONING_SUCCESSFUL` still in the intent on the second call to `onCreate`?",
      "parentUuid": "9c7ca0e5_7c829719",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c2b8f61c_51251ea0",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-06T18:58:24Z",
      "side": 1,
      "message": "As far as I can tell, that\u0027s because the Intent that started the Activity originally hasn\u0027t changed (that\u0027s what is returned by `getIntent()` or, in Kotlin, `intent`). Returning to the existing Activity from SUW doesn\u0027t change that fact; we\u0027re just going back to it. (Also, to be clear, when SUW is called twice, the PID/TID of Bellis is the same each time, so it\u0027s the same instance.)\n\nI\u0027m no expert in these kinds of details of Android apps. I came across this when I was trying to look it up / understand it: https://stackoverflow.com/questions/34195828/how-to-come-back-to-first-activity-without-its-oncreate-called\n\n...and I did try some of the suggestions (singleTask launch mode in the manifest; using the particular flags mentioned), but it always ended up calling onCreate again anyway, so this was all I could think of.\n\nI added Aayush because I know he has experience on the app side of things in case we\u0027re missing something obvious.",
      "parentUuid": "a9b6e8fb_8bbbafdb",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "55c89ee9_2aff4131",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-06T19:14:00Z",
      "side": 1,
      "message": "Hmm ok. Thanks for the info and looking into it. My next thought would be does it still recreate if we call `finish()` after completing the calls below (the one and only time they\u0027d be called)?",
      "parentUuid": "c2b8f61c_51251ea0",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cd00da69_4f1d88e4",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-06T19:16:50Z",
      "side": 1,
      "message": "If we call `finish()`, there\u0027s only one Setup Wizard, yes, but the user doesn\u0027t land in Bellis with the opportunity to manage apps \u0026 content; they land back at the launcher (or presumably wherever they were when they opened Work Profile to set up a new one). If we\u0027re okay with that, it\u0027s a one-liner change.",
      "parentUuid": "55c89ee9_2aff4131",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "95fa26ab_e44ae28f",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-06T19:24:39Z",
      "side": 1,
      "message": "Ok, so far there\u0027s 3 options? The current patch, `finish()` (with the limitation described above), and trying to see if the intent can be removed if it\u0027s returning from the setup wizard (aka no longer the initial callback from provisioning). I\u0027d rather 3 -\u003e 2 -\u003e 1 in order of preference. If there are other options that have not been considered yet I\u0027m also curious",
      "parentUuid": "cd00da69_4f1d88e4",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "24f4d88d_b411b227",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000065
      },
      "writtenOn": "2023-06-07T03:53:14Z",
      "side": 1,
      "message": "I wonder if using ActivityResultContract will fix this",
      "parentUuid": "95fa26ab_e44ae28f",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ff2b248a_86c24715",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000003
      },
      "writtenOn": "2023-06-07T13:57:25Z",
      "side": 1,
      "message": "I\u0027ve seen apps change the intent, like removing/adding an extra to signal that it was handled.\n\nI am skeptical about ActivityResultContract helping here. Isn\u0027t this just a different API for the same thing?",
      "parentUuid": "24f4d88d_b411b227",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b40d88ea_5b2dbdc6",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-07T14:22:28Z",
      "side": 1,
      "message": "Extra may work. Not sure given this is not started for result",
      "parentUuid": "ff2b248a_86c24715",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3d4434b7_4e3f0dd9",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-07T14:34:21Z",
      "side": 1,
      "message": "Adding an extra to that intent from within onCreate does appear to work just as well. It may just be modifying the copy of the intent in memory, so it may not work if Bellis were actually closed or killed before we return to it. But either way it seems to work.",
      "parentUuid": "b40d88ea_5b2dbdc6",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d964fee7_a37c9147",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-07T14:53:03Z",
      "side": 1,
      "message": "Torsten, is there a proper way to modify the intent that started the activity? I can confirm that merely adding an extra to getIntent() changes the app\u0027s in-memory copy only, so if it\u0027s killed for some reason that change is lost, unlike savedInstanceState.",
      "parentUuid": "3d4434b7_4e3f0dd9",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3fcfc341_58643fa1",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-06-07T15:01:34Z",
      "side": 1,
      "message": "I think the extra is meant to be added from suw when returning normally? At least that\u0027s the way I understand it (the way startActivityForResult does it). But it seems like it has its limitations too.\nNonetheless, sounds like Chirayu is seeing this behaviour fixed with the SUW change?",
      "parentUuid": "d964fee7_a37c9147",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aedabd44_8d3e2283",
        "filename": "app/src/main/java/org/calyxos/bellis/MainActivity.kt",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-06-07T15:04:28Z",
      "side": 1,
      "message": "Aayush, to test, I tried:\n\n```\nval startForResult \u003d registerForActivityResult(StartActivityForResult()) {\n    Log.i(TAG, \"launchSUW: activity completed\")\n}\nstartForResult.launch(intent)\n```\n\n...and the SUW activity was \"completed\" before the SUW even finished. It \"completes\" in a few seconds, just sitting idle on the first screen. And then we do end up having `onCreate` called again at the end.",
      "parentUuid": "d964fee7_a37c9147",
      "range": {
        "startLine": 26,
        "startChar": 8,
        "endLine": 28,
        "endChar": 9
      },
      "revId": "777a745bcb8980baf1ecde176e7e86143725498c",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    }
  ]
}